# 程序权限状态显示功能

## 功能说明

在Cursor续杯工具的右上角（设置按钮旁边）新增了程序运行权限状态显示功能，用户可以一目了然地看到当前程序的运行权限级别。

## 显示内容

### 权限级别说明

| 权限级别 | 显示文本 | 图标颜色 | 说明 |
|---------|---------|---------|------|
| **管理员** | 管理员 | 🟢 绿色 | Windows下以管理员身份运行 |
| **Root** | Root用户 | 🔴 红色 | Linux/macOS下以Root权限运行 |
| **Sudo** | Sudo用户 | 🟠 橙色 | Linux下拥有sudo权限的用户 |
| **标准用户** | 标准用户 | 🔵 蓝色 | 普通用户权限 |
| **未知** | 检测失败 | ⚪ 灰色 | 无法检测权限状态 |

### 视觉效果

- **彩色徽章设计**：不同权限级别使用不同的颜色主题
- **图标提示**：每个权限级别都有对应的盾牌图标
- **悬停提示**：鼠标悬停显示详细的权限说明
- **加载动画**：权限检测时显示旋转的时钟图标

## 技术实现

### 后端检测逻辑 (main.js)

#### Windows 平台
```javascript
// 使用 net session 命令检测管理员权限
exec('net session >nul 2>&1', (error) => {
  if (error) {
    // 不是管理员
  } else {
    // 是管理员
  }
});
```

#### Linux/macOS 平台
```javascript
// 检查用户ID
const userId = process.getuid();
if (userId === 0) {
  // Root用户
} else {
  // 检查是否在sudo/wheel/admin组中
  exec('groups', (error, stdout) => {
    const groups = stdout.toLowerCase();
    const hasSudo = groups.includes('sudo') || 
                    groups.includes('wheel') || 
                    groups.includes('admin');
  });
}
```

### 前端显示逻辑 (index.html)

#### 数据结构
```javascript
permissionInfo: {
  level: 'unknown',        // 权限级别
  description: '检测中...', // 显示文本
  loading: true           // 加载状态
}
```

#### CSS样式
- 使用渐变背景和阴影效果
- 不同权限级别有不同的颜色主题
- 悬停时有轻微的动画效果

## 使用场景

### 1. 权限诊断
当用户遇到"数据库文件不存在"或其他权限相关问题时，可以通过权限状态快速判断是否为权限不足导致。

### 2. 安全提示
- **管理员权限**：提醒用户程序拥有完整系统访问权限
- **标准用户**：提醒用户可能无法访问某些系统目录

### 3. 功能可用性指示
某些功能（如访问其他用户目录的数据库）可能需要管理员权限，权限状态帮助用户理解功能限制。

## 权限建议

### 推荐权限级别
- **Windows**：建议以管理员身份运行，确保能够访问所有用户的Cursor数据库
- **Linux/macOS**：普通用户权限即可，必要时使用sudo

### 权限不足时的影响
1. **无法访问其他用户目录**：只能使用当前用户的Cursor数据库
2. **某些系统操作受限**：如修改系统级配置文件
3. **文件权限错误**：可能无法修改某些Cursor配置文件

## 故障排除

### 权限显示为"检测失败"
1. 检查操作系统兼容性
2. 确认程序有足够权限执行系统命令
3. 查看控制台日志获取详细错误信息

### 权限显示不准确
1. 可能由于系统安全策略限制
2. 某些虚拟化环境下权限检测可能不准确
3. 重启程序重新检测

## 安全说明

- **权限检测是只读操作**：不会修改任何系统设置
- **最小权限原则**：建议仅在需要时使用管理员权限
- **透明度**：用户始终知道程序的运行权限级别
